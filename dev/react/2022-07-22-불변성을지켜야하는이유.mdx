---
slug: test
title: 불변성을 지켜야 하는 이유
authors: [yjh]
tags: [React, Hook, state]
draft: true
---

<div className="preview">
  불변성이란 어떤값을 직접적으로 변경하지 않고 새로운 값을 만드는 것을 말한다.
</div>

<!--truncate-->

> 불변성이란 어떤값을 직접적으로 변경하지 않고 새로운 값을 만드는 것을 말한다.

<!-- https://bohyeon-n.github.io/deploy/react/react_immutable.html -->

## JS에서의 불변성

<!-- https://velog.io/@han-byul-yang/Javascript-Javascript-%EB%B6%88%EB%B3%80%EC%84%B1 -->

우선 아래 코드로 자바스크립트에서 불변성에대해 알아보자.

```js
const userA = {
  name: '호롤롤',
  phone: '000-0000-0000',
  address: '대한민국 어딘가',
};

const userB = userA;

userA.name = 'ㅋㅋㅋㅋ';

console.log(userA.name); // result: 'ㅋㅋㅋㅋ'
console.log(userB.name); // result: 'ㅋㅋㅋㅋ'
```

userA.name을 변경 했는데 userB.name도 같이 바뀌었다.  
`이런 상황은 값을 예측할 수 없게 하거나 예기치 못한 버그를 유발`할 수 있기 때문에 불변성을 지켜줘야한다.

<br />

### 불변성을 유지하는 방법

`spread operator(얕은복사)` 사용하기

```js
const userB = { ...userB };
```

> spread operator를 사용하여 새로운 객체를 생성했기 때문에 userA와 userB의 참조값이 달라진다.

<br />

spread operator를 사용하더라도 객체의 깊이가 깊어지면 똑같은 문제가 생긴다.

```js
const userA = {
  name: '호롤롤',
  phone: '000-0000-0000',
  address: '대한민국 어딘가',
  post: ['호', '롤', '롤'],
};

const userB = { ...userA };

const userC = {
  ...userA,
  post: [...userA.post],
};

// userA === userB -> false
// userA.post === userB.post -> true
// userA.post === userC.post -> false
```

때문에 깊이가 점점 깊어지면 불변성 유지가 힘들어져 `immer`등의 라이브러리를 사용해 불변성을 유지하기도 한다.

## React에서의 불변성

이제 리액트에서 불변성을 지켜줘야하는 이유를 알아보자

<br />

### 리렌더링

일반적으로 컴포넌트는 부모 컴포넌트가 리렌더링 되거나 props 또는 상태 값이 변경됐을 때 리렌더링된다.

<br />

### 값 변경 감지

`props와 상태 변경을 감지를 위해 이전 값과 현재 값을 하나씩 비교하지 않고 성능 최적화를 위해 얕은 비교를 실행한다.`

<br />

<!-- 위와 같이 user.name 값을 바꾸고 setState 실행해 값을 변경했다고 하더라도 기존
user와 setUser 넘겨준 데이터의 참조 값이 같기 때문에 컴포넌트는 다시 렌더링되지 않는다. -->

아래 코드를 보면 state 값을 직접적으로 변경 후 setState를 실행해 변경된 값을 전달했다.

```js
const [user, setUser] = useState({
  name: '호롤롤',
  phone: '000-0000-0000',
});

user.name = '로로로';
setState(user);
```

setUser가 실행되면 현재 값과 전달 받은 값을 비교한다.  
값을 변경했지만 리액트에선 얕은 비교를 실행하기 때문에 값이 변경되었다고 판단하지 않는다.

<br />

`즉 리액트에서 값 변경을 감지하지 못하고 당연히 리렌더링도 되지 않기 때문에 불변성을 지키는 게 중요하다.`

<br />

<!-- https://velog.io/@devmag/React-state-%EB%B3%80%EA%B2%BD-%EC%8B%9C-%EC%99%9C-useState-setState%EB%A5%BC-%EC%93%B0%EB%8A%94%EA%B0%80 -->
